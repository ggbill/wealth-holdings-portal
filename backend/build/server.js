!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("shrink-ray-current")},function(e,t,r){"use strict";r.r(t);var o=r(1),n=r(2),s=r(3);var i=(e,t,r)=>{console.info(`${e.method} ${e.originalUrl}`);const o=(new Date).getTime();t.on("finish",()=>{const r=(new Date).getTime()-o,n=`${e.method} ${e.originalUrl} ${t.statusCode} ${r}ms`;console.info(n)}),r()},a=r(0);const c=new a.Schema({_last_action:{type:String,required:!0},_last_action_performed_by:{type:Object,required:!0},_last_action_performed_at:{type:Date,required:!0},_flow_id:{type:String,required:!0},_current_context:[{type:Object,required:!0}],_kissflow_id:{type:String,required:!0},_created_by:{type:Object,required:!0},_modified_by:{type:Object,required:!0},_created_at:{type:Date,required:!0},_modified_at:{type:Date,required:!0},_flow_name:{type:String,required:!0},_current_step:{type:String},_current_assigned_to:[{type:Object,required:!0}],_status:{type:String,required:!0},_stage:{type:Number,required:!0},_root_process_instance:{type:String,required:!0},_submitted_at:{type:Date,required:!0},_request_number:{type:Number,required:!0},_counter:{type:Number,required:!0},_last_completed_step:{type:String,required:!0},_progress:{type:Number,required:!0},buyer:{type:String},seller:{type:String},isCloseCase:{type:Boolean},closeCaseReason:{type:String},closeCaseDescription:{type:String},isReEngage:{type:Boolean},reEngageDate:{type:Date},aum:{type:Number},recurringFees:{type:Number},turnover:{type:Number},ebitda:{type:Number},planners:{type:Number},clients:{type:Number},customers:{type:Number},valuation:{type:Number},wealthHoldingsFee:{type:Number},introducerFee:{type:Number},simplyBizFee:{type:Number},completionDate:{type:Date},purchaseType:{type:String},paymentSchedule:[{type:Object}],finalTransactionReferenceNumber:{type:String},currentStatus:{type:String},activityAction:{type:String}});var u=a.model("Marriage-Bureau-Webhook",c);const _=new a.Schema({_last_action:{type:String,required:!0},_last_action_performed_by:{type:Object,required:!0},_last_action_performed_at:{type:Date,required:!0},_flow_id:{type:String,required:!0},_current_context:[{type:Object,required:!0}],_kissflow_id:{type:String,required:!0},_created_by:{type:Object,required:!0},_modified_by:{type:Object,required:!0},_created_at:{type:Date,required:!0},_modified_at:{type:Date,required:!0},_flow_name:{type:String,required:!0},_current_step:{type:String},_current_assigned_to:[{type:Object,required:!0}],_status:{type:String,required:!0},_stage:{type:Number,required:!0},_root_process_instance:{type:String,required:!0},_submitted_at:{type:Date,required:!0},_request_number:{type:Number,required:!0},_counter:{type:Number,required:!0},_last_completed_step:{type:String,required:!0},_progress:{type:Number,required:!0},enquiryMethod:{type:String},enquirySource:{type:String},primaryContact:{type:String},preferredEmail:{type:String},preferredPhone:{type:String},firmName:{type:String},fcaNumber:{type:String},companyType:{type:String},isSimplyBizMember:{type:String},isCloseCase:{type:Boolean},closeCaseReason:{type:String},closeCaseDescription:{type:String},isReEngage:{type:Boolean},reEngageDate:{type:Date},officeAddress:{type:String},operatingRegionList:[{type:String}],officeLocation:{type:String},currentStatus:{type:String},activityAction:{type:String},completeActivityAction:{type:String},fundsAvailable:{type:Number}});var l=a.model("Buyer-Onboarding-Webhook",_);const d=new a.Schema({_last_action:{type:String,required:!0},_last_action_performed_by:{type:Object,required:!0},_last_action_performed_at:{type:Date,required:!0},_flow_id:{type:String,required:!0},_current_context:[{type:Object,required:!0}],_kissflow_id:{type:String,required:!0},_created_by:{type:Object,required:!0},_modified_by:{type:Object,required:!0},_created_at:{type:Date,required:!0},_modified_at:{type:Date,required:!0},_flow_name:{type:String,required:!0},_current_step:{type:String},_current_assigned_to:[{type:Object,required:!0}],_status:{type:String,required:!0},_stage:{type:Number,required:!0},_root_process_instance:{type:String,required:!0},_submitted_at:{type:Date,required:!0},_request_number:{type:Number,required:!0},_counter:{type:Number,required:!0},_last_completed_step:{type:String,required:!0},_progress:{type:Number,required:!0},enquiryMethod:{type:String},enquirySource:{type:String},primaryContact:{type:String},preferredEmail:{type:String},preferredPhone:{type:String},firmName:{type:String},fcaNumber:{type:String},companyType:{type:String},isSimplyBizMember:{type:String},isCloseCase:{type:Boolean},closeCaseReason:{type:String},closeCaseDescription:{type:String},isReEngage:{type:Boolean},reEngageDate:{type:Date},officeAddress:{type:String},operatingRegionList:[{type:String}],officeLocation:{type:String},currentStatus:{type:String},activityAction:{type:String},completeActivityAction:{type:String}});var p,y,m=a.model("Seller-Onboarding-Webhook",d);(y=p||(p={})).WriteMarriageBureauWebhookToDB=async function(e){return new Promise((t,r)=>{const{_id:o,...n}=e;let s,i,a,c,_,l,d,p;e.AUM&&(s=Number(e.AUM.split(" ")[0])),e.Recurring_Fees&&(i=Number(e.Recurring_Fees.split(" ")[0])),e.Turnover&&(a=Number(e.Turnover.split(" ")[0])),e.EBITDA&&(c=Number(e.EBITDA.split(" ")[0])),e.Valuation&&(_=Number(e.Valuation.split(" ")[0])),e.Wealth_Holdings_Fee&&(l=Number(e.Wealth_Holdings_Fee.split(" ")[0])),e.Introducer_Fee&&(d=Number(e.Introducer_Fee.split(" ")[0])),e.SimplyBiz_Fee&&(p=Number(e.SimplyBiz_Fee.split(" ")[0])),u.create({...n,_kissflow_id:e._id,buyer:e.Buyer,seller:e.Seller,isCloseCase:e.Close_Case,closeCaseReason:e.Close_Case_Reason,closeCaseDescription:e.Close_Case_Description,isReEngage:e.ReEngage_In_Future,reEngageDate:e.ReEngage_Date,aum:s,recurringFees:i,turnover:a,ebitda:c,planners:e.Planners,clients:e.Clients,customers:e.Customers,valuation:_,wealthHoldingsFee:l,introducerFee:d,simplyBizFee:p,completionDate:e.Completion_Date,purchaseType:e.Purchase_Type,finalTransactionReferenceNumber:e.Transaction_Reference_Number_1,currentStatus:e.Current_Status,activityAction:e.Activity_Action},(function(e,o){e&&(console.log(e),r(e)),t(o)}))})},y.WriteBuyerOnboardingWebhookToDB=async function(e){return new Promise((t,r)=>{const{_id:o,...n}=e;let s;e.Funds_Available&&(s=Number(e.Funds_Available.split(" ")[0])),l.create({...n,_kissflow_id:e._id,enquiryMethod:e.Enquiry_Method,enquirySource:e.Enquiry_Source,primaryContact:e.Primary_Contact,preferredEmail:e.Preferred_Email,preferredPhone:e.Preferred_Phone,firmName:e.Firm_Name,fcaNumber:e.FCA_Number,companyType:e.Company_Type,isSimplyBizMember:e.SimplyBiz_Member,isCloseCase:e.Close_Case,closeCaseReason:e.Close_Case_Reason,closeCaseDescription:e.Close_Case_Description,isReEngage:e.Engage_in_Future,reEngageDate:e.Reengage_Date,officeAddress:e.Office_Address,operatingRegionList:e.Operating_Region,officeLocation:e.Office_Location,currentStatus:e.Current_Status,activityAction:e.Activity_Action,completeActivityAction:e.Complete_Activity_Action,fundsAvailable:s},(function(e,o){e&&(console.log(e),r(e)),t(o)}))})},y.WriteSellerOnboardingWebhookToDB=async function(e){return new Promise((t,r)=>{const{_id:o,...n}=e;m.create({...n,_kissflow_id:e._id,enquiryMethod:e.Enquiry_Method,enquirySource:e.Enquiry_Source,primaryContact:e.Primary_Contact,preferredEmail:e.Preferred_Email,preferredPhone:e.Preferred_Phone,firmName:e.Firm_Name,fcaNumber:e.FCA_Number,companyType:e.Company_Type,isSimplyBizMember:e.SimplyBiz_Member,isCloseCase:e.Close_Case,closeCaseReason:e.Close_Case_Reason,closeCaseDescription:e.Close_Case_Description,isReEngage:e.Engage_in_Future,reEngageDate:e.Reengage_Date,officeAddress:e.Office_Address,operatingRegionList:e.Operating_Region,officeLocation:e.Office_Location,currentStatus:e.Current_Status,activityAction:e.Activity_Action,completeActivityAction:e.Complete_Activity_Action},(function(e,o){e&&(console.log(e),r(e)),t(o)}))})};const f=r(1).Router();f.post("/marriage-bureau/hook",(e,t)=>{try{t.status(200).end(),p.WriteMarriageBureauWebhookToDB(e.body).then(e=>{t.status(200).end()}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),f.post("/buyer-onboarding/hook",(e,t)=>{try{t.status(200).end(),p.WriteBuyerOnboardingWebhookToDB(e.body).then(e=>{t.status(200).end()}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),f.post("/seller-onboarding/hook",(e,t)=>{try{t.status(200).end(),p.WriteSellerOnboardingWebhookToDB(e.body).then(e=>{t.status(200).end()}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}});var g,$,b=f;($=g||(g={})).GetLatestDataForActiveCases=async function(){return new Promise((e,t)=>{u.aggregate([{$sort:{_modified_at:1}},{$group:{_id:"$_kissflow_id",firmName:{$last:"$firmName"},buyer:{$last:"$buyer"},seller:{$last:"$seller"},fcaNumber:{$last:"$fcaNumber"},officeLocation:{$last:"$officeLocation"},isSimplyBizMember:{$last:"$isSimplyBizMember"},maxProgress:{$max:"$_progress"},_current_assigned_to:{$last:{$arrayElemAt:["$_current_assigned_to",0]}},previousStep:{$last:{$arrayElemAt:["$_current_context",0]}},_current_step:{$last:"$_current_step"},_created_at:{$last:"$_created_at"},_last_action_performed_at:{$last:"$_last_action_performed_at"},aum:{$last:"$aum"},recurringFees:{$last:"$recurringFees"},turnover:{$last:"$turnover"},ebitda:{$last:"$ebitda"},planners:{$last:"$planners"},clients:{$last:"$clients"},customers:{$last:"$customers"},representing:{$last:"$representing"},wealthHoldingsFee:{$last:"$wealthHoldingsFee"},introducerFee:{$last:"$introducerFee"},simplyBizFee:{$last:"$simplyBizFee"},valuation:{$last:"$valuation"},currentStatus:{$last:"$currentStatus"}}}],(function(r,o){r&&(console.log(r),t(r));let n=o.filter(e=>null!==e._current_step);e(n)}))})},$.GetClosedCases=async function(){return new Promise((e,t)=>{u.find({_status:"Completed"},(function(t,r){t&&console.error("Error: "+t),e(r)}))})},$.GetInstanceDetails=async function(e){return console.log(e),new Promise((t,r)=>{u.find({_kissflow_id:e},(function(e,r){e&&console.error("Error: "+e),t(r)}))})},$.GetActions=async function(){return new Promise((e,t)=>{u.find({},(function(t,r){t&&console.error("Error: "+t),e(r)}))})};const S=r(1).Router();S.get("/getLatestDataForActiveCases",(e,t)=>{try{g.GetLatestDataForActiveCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),S.get("/getClosedCases",(e,t)=>{try{g.GetClosedCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),S.get("/getInstanceDetails/:id",(e,t)=>{try{g.GetInstanceDetails(e.params.id).then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),S.get("/getActions",(e,t)=>{try{g.GetActions().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}});var h,C,q=S;(C=h||(h={})).GetLatestDataForActiveCases=async function(){return new Promise((e,t)=>{l.aggregate([{$sort:{_modified_at:1}},{$group:{_id:{_kissflow_id:"$_kissflow_id",_current_step:"$_current_step"},firmName:{$last:"$firmName"},fcaNumber:{$last:"$fcaNumber"},officeLocation:{$last:"$officeLocation"},isSimplyBizMember:{$last:"$isSimplyBizMember"},fundsAvailable:{$last:"$fundsAvailable"},maxProgress:{$max:"$_progress"},_current_assigned_to:{$last:{$arrayElemAt:["$_current_assigned_to",0]}},previousStep:{$last:{$arrayElemAt:["$_current_context",0]}},_current_step:{$last:"$_current_step"},_created_at:{$last:"$_created_at"},_submitted_at:{$last:"$_submitted_at"},_last_action_performed_at:{$first:"$_last_action_performed_at"},currentStatus:{$last:"$currentStatus"}}},{$sort:{_last_action_performed_at:-1}},{$group:{_id:"$_id._kissflow_id",firmName:{$first:"$firmName"},fcaNumber:{$first:"$fcaNumber"},officeLocation:{$first:"$officeLocation"},isSimplyBizMember:{$first:"$isSimplyBizMember"},fundsAvailable:{$first:"$fundsAvailable"},maxProgress:{$first:"$_progress"},_current_assigned_to:{$first:"$_current_assigned_to"},previousStep:{$first:"$previousStep"},_current_step:{$first:"$_current_step"},_created_at:{$first:"$_created_at"},_submitted_at:{$first:"$_submitted_at"},_last_action_performed_at:{$first:"$_last_action_performed_at"},currentStatus:{$first:"$currentStatus"}}}],(function(r,o){r&&(console.log(r),t(r));let n=o.filter(e=>null!==e._current_step);e(n)}))})},C.GetClosedCases=async function(){return new Promise((e,t)=>{l.find({_status:"Completed"},(function(t,r){t&&console.error("Error: "+t),e(r)}))})},C.GetInstanceDetails=async function(e){return console.log(e),new Promise((t,r)=>{l.find({_kissflow_id:e},(function(e,r){e&&console.error("Error: "+e),t(r)}))})},C.GetActions=async function(){return new Promise((e,t)=>{l.find({},(function(t,r){t&&console.error("Error: "+t),e(r)}))})};const E=r(1).Router();E.get("/getLatestDataForActiveCases",(e,t)=>{try{h.GetLatestDataForActiveCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),E.get("/getClosedCases",(e,t)=>{try{h.GetClosedCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),E.get("/getInstanceDetails/:id",(e,t)=>{try{h.GetInstanceDetails(e.params.id).then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),E.get("/getActions",(e,t)=>{try{h.GetActions().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}});var v,N,A=E;(N=v||(v={})).GetLatestDataForActiveCases=async function(){return new Promise((e,t)=>{m.aggregate([{$sort:{_modified_at:1}},{$group:{_id:{_kissflow_id:"$_kissflow_id",_current_step:"$_current_step"},firmName:{$last:"$firmName"},fcaNumber:{$last:"$fcaNumber"},officeLocation:{$last:"$officeLocation"},isSimplyBizMember:{$last:"$isSimplyBizMember"},maxProgress:{$max:"$_progress"},_current_assigned_to:{$last:{$arrayElemAt:["$_current_assigned_to",0]}},previousStep:{$last:{$arrayElemAt:["$_current_context",0]}},_current_step:{$last:"$_current_step"},_created_at:{$last:"$_created_at"},_submitted_at:{$last:"$_submitted_at"},_last_action_performed_at:{$first:"$_last_action_performed_at"},currentStatus:{$last:"$currentStatus"}}},{$sort:{_last_action_performed_at:-1}},{$group:{_id:"$_id._kissflow_id",firmName:{$first:"$firmName"},fcaNumber:{$first:"$fcaNumber"},officeLocation:{$first:"$officeLocation"},isSimplyBizMember:{$first:"$isSimplyBizMember"},maxProgress:{$first:"$_progress"},_current_assigned_to:{$first:"$_current_assigned_to"},previousStep:{$first:"$previousStep"},_current_step:{$first:"$_current_step"},_created_at:{$first:"$_created_at"},_submitted_at:{$first:"$_submitted_at"},_last_action_performed_at:{$first:"$_last_action_performed_at"},currentStatus:{$first:"$currentStatus"}}}],(function(r,o){r&&(console.log(r),t(r));let n=o.filter(e=>null!==e._current_step);e(n)}))})},N.GetClosedCases=async function(){return new Promise((e,t)=>{m.find({_status:"Completed"},(function(t,r){t&&console.error("Error: "+t),e(r)}))})},N.GetInstanceDetails=async function(e){return console.log(e),new Promise((t,r)=>{m.find({_kissflow_id:e},(function(e,r){e&&console.error("Error: "+e),t(r)}))})},N.GetActions=async function(){return new Promise((e,t)=>{m.find({},(function(t,r){t&&console.error("Error: "+t),e(r)}))})};const D=r(1).Router();D.get("/getLatestDataForActiveCases",(e,t)=>{try{v.GetLatestDataForActiveCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),D.get("/getClosedCases",(e,t)=>{try{v.GetClosedCases().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),D.get("/getInstanceDetails/:id",(e,t)=>{try{v.GetInstanceDetails(e.params.id).then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),D.get("/getActions",(e,t)=>{try{v.GetActions().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}});var w=D;const B=new a.Schema({orderNumber:{type:Number,required:!0},activityName:{type:String,required:!0},process:{type:String,required:!0},amberSla:{type:Number,required:!0},redSla:{type:Number,required:!0}});var F,P,O=a.model("Setting",B);(P=F||(F={})).GetSettings=async function(){return new Promise((e,t)=>{O.find({},(function(t,r){t&&console.error("Error: "+t),e(r)}))})},P.UpdateSettings=async function(e){return new Promise((t,r)=>{const o=e.map(e=>({updateOne:{filter:{_id:e._id},update:e,upsert:!0}}));O.bulkWrite(o).then(e=>t(e)).catch(e=>console.error("BULK update error:",e))})};const j=r(1).Router();j.get("/getSettings",(e,t)=>{try{F.GetSettings().then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}}),j.post("/",(e,t)=>{try{F.UpdateSettings(e.body).then(e=>{t.json(e)}).catch(e=>{t.status(500),t.end,console.error("Error: ",e)})}catch(e){t.status(500),t.end,console.error("Error: ",e)}});var M=j;const R=r(5),k=r(6),L=o();L.use(k()),L.use(n()),L.use(s.json()),L.use(i),L.use("/kissflow",b),L.use("/marriage-bureau",q),L.use("/buyer-onboarding",A),L.use("/seller-onboarding",w),L.use("/settings",M),L.use(o.static(R.resolve("..","frontend","build"))),L.get("*",(e,t)=>{t.sendFile(R.resolve("..","frontend","build","index.html"))});var x=L,G=r(4);const T=process.env.PORT||8080,z=G.createServer(x);z.listen(T),z.on("error",e=>{console.error(e)}),z.on("listening",async()=>{console.info(`Listening on a port ${T}`),a.connect(process.env.MONGODB_URI||"mongodb://localhost:27017/wealth_holdings_portal_local",{useNewUrlParser:!0,useFindAndModify:!1}),a.connection.once("open",()=>{console.info("Connected to Mongo via Mongoose")}),a.connection.on("error",e=>{console.error("Unable to connect to Mongo via Mongoose",e)})})}]);